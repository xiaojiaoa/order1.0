<%- include('../layouts/head_top'); %>
<%- include('../layouts/head_bottom'); %>
<%- include('../layouts/header'); %>
<%- include('../layouts/nav'); %>


<!-- MAIN PANEL -->
<div id="main" role="main">

    <!-- RIBBON -->
    <div id="ribbon">

        <!-- breadcrumb -->
        <ol class="breadcrumb">
            <li>后台管理</li>
            <li>订单详情</li>
        </ol>
        <!-- end breadcrumb -->
    </div>
    <!-- END RIBBON -->


    <!-- MAIN CONTENT -->
    <div id="content">


        <!-- well -->
        <div class="well dwy-show-well">
            <!-- row -->
            <div class="row">
                <!-- col -->
                <div class="col-xs-12 dwy-show-content">
                    <legend>基本信息</legend>
                    <!-- row -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped table-information">
                            <tbody>
                            <tr>
                                <td>主材颜色</td>
                                <td>(静态数据)象牙白</td>
                                <td>订单类型</td>
                                <td>(静态数据)新配套-五金</td>
                            </tr>
                            <tr>
                                <td>型号</td>
                                <td>(静态数据)</td>
                                <td>风格</td>
                                <td><%= DWY_Helper.getAssistVal(orderInfo.decoStyleId, styleInfo) %></td>
                            </tr>
                            <tr>
                                <td>专卖店</td>
                                <td><%= orderInfo.storeAddress %></td>
                                <td>专卖店编号</td>
                                <td><%= orderInfo.bid %></td>
                            </tr>
                            <tr>
                                <td>收货人</td>
                                <td><%= orderInfo.recName %></td>
                                <td>联系电话</td>
                                <td><%= orderInfo.recMobile %></td>
                            </tr>
                            <tr>
                                <td>收货地址</td>
                                <td colspan="3"><%= orderInfo.recAddress %></td>
                            </tr>
                            <tr>
                                <td>客户编号</td>
                                <td><a href="/customer/detail<%= orderInfo.cid %>"><%= orderInfo.cid %></a></td>
                                <td>客户姓名</td>
                                <td><%= orderInfo.name %></td>
                            </tr>
                            <tr>
                                <td>客户电话</td>
                                <td><%= orderInfo.mobile %></td>
                                <td>约定交付日期</td>
                                <td><%= DWY_Helper.getLocalDate(orderInfo.deliveryDate) %></td>
                            </tr>
                            <tr>
                                <td>客户地址</td>
                                <td colspan="3"><%= orderInfo.address %></td>
                            </tr>
                            <tr>
                                <td>流水号</td>
                                <td colspan="3"><a href="/taskseq/index/<%= orderInfo.lid %>"><%= orderInfo.lid %></a>
                                </td>
                            </tr>
                            <tr>
                                <td>产品信息</td>
                                <td><%= orderInfo.prodInfo %></td>
                                <td>包装信息</td>
                                <td>(静态数据)</td>
                            </tr>
                            <tr>
                                <td>难度等级</td>
                                <td>
                                    <div><%= orderInfo.difficulty %></div>

                                    <div style="display: none">
                                        <hr class="simple">
                                        订单信息（难度、许可）时显示此区域
                                        <form class="form-horizontal" method="post" action="">
                                            <div class="col-xs-4">
                                                <select class="form-control" name="type">
                                                    <option value="">- 未定 -</option>
                                                    <option value="1">一级</option>
                                                </select>
                                            </div>
                                            <div class="col-xs-2">
                                                <button class="btn btn-primary " type="submit">确定</button>
                                            </div>
                                        </form>
                                    </div>
                                </td>
                                <td>零售价</td>
                                <td>(静态数据)0.00元</td>
                            </tr>
                            <tr>
                                <td>所在空间</td>
                                <td><%= orderInfo.spaceName %></td>
                                <td>产品</td>
                                <td>(静态数据)</td>
                            </tr>
                            <tr>
                                <td>建单人</td>
                                <td><%= orderInfo.channelName %> 13568749894(静态数据)</td>
                                <td>橱柜设计师</td>
                                <td>(静态数据)</td>
                            </tr>
                            <tr>
                                <td>建单时间</td>
                                <td><%= DWY_Helper.getLocalDate(orderInfo.addTime) %></td>
                                <td>提交时间</td>
                                <td>(静态数据)</td>
                            </tr>
                            <tr>
                                <td>方案码</td>
                                <td>(静态数据)</td>
                                <td>软件序列号</td>
                                <td>(静态数据)</td>
                            </tr>
                            <tr>
                                <td>备注</td>
                                <td colspan="3"><%= orderInfo.remark %></td>
                            </tr>
                            <tr>
                                <td>电商产品信息</td>
                                <td colspan="3" class="no-padding">
                                    <table class="table table-bordered table-striped table-noneinf">
                                        <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>型号</th>
                                            <th>名称</th>
                                            <th>尺寸</th>
                                            <th>参数</th>
                                            <th>单位</th>
                                            <th>数量</th>
                                            <th>说明</th>
                                            <th>编码</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>(静态数据)132465</td>
                                            <td>(静态数据)asddas-46566</td>
                                            <td>(静态数据)衣柜asdsad</td>
                                            <td>(静态数据)760*480*220</td>
                                            <td>(静态数据)</td>
                                            <td>(静态数据)个</td>
                                            <td>(静态数据)1</td>
                                            <td>(静态数据)</td>
                                            <td>(静态数据)</td>
                                        </tr>
                                        <tr>
                                            <td colspan="6" class="text-align-right">合计</td>
                                            <td colspan="3">(静态数据)12</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>

                            <tr>
                                <td>同客户订单</td>
                                <td colspan="3">
                                    <%
                                    var orderList = "";
                                    orderInfo.orders.forEach(function (orderElement) { %>
                                    <a href="/order/detail/<%= orderElement %>"><%= orderElement %></a>
                                    <% }) %>
                                </td>
                            </tr>
                            <tr>
                                <td>相关订单</td>
                                <td colspan="3">
                                    <%
                                    orderInfo.resupplys.forEach(function (element) { %>
                                    <a href="/order/resupply/detail/<%= element.tid %>/<%= element.resId %>"><%= element.resId %></a>
                                    <% }) %>
                                </td>
                            </tr>


                            </tbody>
                        </table>

                    </div>


                    <!-- end row -->
                </div>
                <!-- end col -->
            </div>

            <div class="row">
                <!-- col -->
                <div class="col-xs-12 dwy-show-content">
                    <legend>相关文件
                        <!--<a class="label label-primary" href="/file/create/<%= orderInfo.lid %>/<%= orderInfo.stcode %>">文件管理</a>-->
                        <a class="label label-primary" href="/file/order/create/<%= orderInfo.lid %>/1/<%= tid %>">文件管理</a>
                        <button class="label label-primary" id="orderItem">订单物料</button>
                    </legend>

                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                            <tr>
                                <th>序号</th>
                                <th>文件名</th>
                                <th>文件类型</th>
                                <!--<th>文件大小</th>-->
                                <th>上传人</th>
                                <th>上传时间</th>
                                <th>备注</th>
                            </tr>
                            </thead>
                            <tbody>
                            <%
                            orderInfo.ordfiles.forEach(function (element, index) { %>
                            <tr>
                                <td><%= index + 1 %></td>
                                <td>
                                    <a href="<%= DWY_GLOBAL.Static %>/download?url=<%= element.savePath %>"><%= element.fileName %></a>
                                </td>
                                <td><%= DWY_Helper.getAssistVal(element.ordType, allFileTypeInfo) %></td>

                                <td><%= element.gid %></td>
                                <td><%= DWY_Helper.getLocalDate(element.addTime) %></td>
                                <td><%= element.remark %></td>
                            </tr>
                            <% }) %>

                            </tbody>
                        </table>

                    </div>


                    <!-- end row -->
                </div>
                <!-- end col -->
            </div>

            <div class="row">
                <!-- col -->
                <div class="col-xs-12 dwy-show-content">
                    <legend>状态信息 (订单状态:<%= orderInfo.stcode %><%= DWY_Helper.getAssistVal(orderInfo.stcode, stcodeInfo) %> )
                        <% if( (orderInfo.stcode == 250) || (orderInfo.stcode == 450) ){ %>
                        <!--审核中-->
                        <a class="label label-primary">解锁</a>
                        <% } %>
                    </legend>
                    <!-- row -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped table-information">
                            <tbody>
                            <tr>
                                <td>许可状态</td>
                                <td colspan="3">审核未加急 拆单不许可 排产未定</td>
                            </tr>
                            <tr style="display: none">
                                <td>许可状态： 订单信息（难度、许可）时显示此区行</td>
                                <td colspan="3">
                                    <form class="form-horizontal" method="post" action="">
                                        <div class="col-xs-3">
                                            <select class="form-control" name="type">
                                                <option value="">- 审核是否加急 -</option>
                                                <option value="1">审核未加急</option>
                                                <option value="2">审核加急</option>
                                            </select>
                                        </div>
                                        <div class="col-xs-3">
                                            <select class="form-control" name="type">
                                                <option value="">- 拆单是否许可 -</option>
                                                <option value="1">拆单未许可</option>
                                                <option value="2">拆单许可</option>
                                                <option value="3">拆单加急</option>
                                            </select>
                                        </div>
                                        <div class="col-xs-3">
                                            <select class="form-control" name="type">
                                                <option value="">- 排产是否许可 -</option>
                                                <option value="1">排产未定</option>
                                                <option value="2">排产暂缓</option>
                                                <option value="3">排产许可</option>
                                            </select>
                                        </div>
                                        <div class="col-xs-2">
                                            <a class="btn btn-primary " id="">标记待审核</a>
                                        </div>
                                    </form>
                                </td>
                            </tr>

                            <tr>
                                <td>审核时间</td>

                                <% switch(orderInfo.stcode){
                                    case 250:  %>
                                <td>
                                    审核中
                                    <a class="label label-primary margin-left-20" id="check-pass-modal">提交审核</a>
                                    <a class="label label-primary margin-left-20 reject-modal" id="check-reject-modal">审核退回</a>
                                </td>
                                <%        break;
                                    case 220: %>
                                <td>待审核
                                    <a class="label label-primary margin-left-20" id="submitOrder">标记为审核中</a>
                                </td>
                                <%         break;
                                    default: %>
                                        <td>2016-02-02</td>
                                <%  } %>


                                <td>审核人</td>
                                <td></td>
                            </tr>

                            <tr>
                                <td>收款确认</td>
                                <td></td>
                                <td>确认人</td>
                                <td>张三</td>
                            </tr>
                            <tr>
                                <td>拆单时间</td>
                                <% switch (orderInfo.stcode){
                                    case 450: %>
                                <td>
                                    拆单中
                                    <a class="label label-primary margin-left-20" id="doTearPass">确定拆单</a>
                                    <a class="label label-primary margin-left-20 reject-modal">拆单退回</a>
                                </td>
                                <%         break;

                                    default: %>
                                <td>2016-02-02</td>
                                <%  } %>

                                <td>拆单人</td>
                                <td></td>
                            </tr>
                            <!--<tr>-->
                                <!--<td>拆单时间（待拆单）</td>-->
                                <!--<td>-->
                                    <!--待拆单-->
                                    <!--<a class="label label-primary">标记为拆单中</a>-->
                                <!--</td>-->
                                <!--<td>拆单人</td>-->
                                <!--<td></td>-->
                            <!--</tr>-->
                            <tr>
                                <td>拆单审核</td>
                                <% switch (orderInfo.stcode){
                                case 475: %>
                                <td>
                                    拆单审核中
                                    <a class="label label-primary margin-left-20" id="doTearCheckPass">确定审核</a>
                                    <a class="label label-primary margin-left-20 reject-modal">拆单审核退回</a>
                                </td>
                                <%        break;
                                case 472: %>
                                <td>
                                    待拆单审核
                                    <a class="label label-primary">标记为拆单审核中</a>
                                </td>
                                <%         break;
                                    default: %>
                                <td>2016-02-02</td>
                                <%  } %>

                                <td>审核人</td>
                                <td></td>
                            </tr>

                            <tr>
                                <td>特排时间</td>
                                <td></td>
                                <td>特排人</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>排产时间</td>
                                <td></td>
                                <td>排产人</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>入库日期</td>
                                <td></td>
                                <td>货架号</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>出仓时间</td>
                                <td></td>
                                <td>出仓人</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>发货日期</td>
                                <td></td>
                                <td>货运单号</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>开始安装时间</td>
                                <td></td>
                                <td>结束安装时间</td>
                                <td>2016-10-10 10：10：10</td>
                            </tr>
                            <tr>
                                <td>安装人</td>
                                <td></td>
                                <td>安装次数</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>安装意见</td>
                                <td colspan="3"></td>
                            </tr>
                            <tr>
                                <td>回访时间</td>
                                <td></td>
                                <td>回访电话</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>回访人</td>
                                <td></td>
                                <td>回访次数</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>客户评价</td>
                                <td colspan="3"></td>
                            </tr>
                            <tr>
                                <td>回访意见</td>
                                <td colspan="3"></td>
                            </tr>
                            <tr>
                                <td>流程记录</td>
                                <td colspan="3">发浙联物流，自提 <a class="margin-left-20" href="/order/process">添加/查看更多</a>
                                </td>
                            </tr>

                            </tbody>
                        </table>

                    </div>


                    <!-- end row -->
                </div>
                <!-- end col -->
            </div>

            <div class="row">

                <div class="col-xs-12">
                    <legend>发货清单(静态数据)</legend>
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>

                            <tr>
                                <th rowspan="2">序号</th>
                                <th rowspan="2">车间</th>
                                <th rowspan="2">包号</th>
                                <th rowspan="2">属性</th>
                                <th rowspan="2">特包</th>
                                <th colspan="3">纸箱</th>
                                <th rowspan="2">产品名称</th>
                                <th rowspan="2">流水号</th>
                                <th rowspan="2">批号</th>
                                <th rowspan="2">工序</th>
                                <th rowspan="2">入库时间</th>
                                <th rowspan="2">接收人</th>
                                <th rowspan="2">出仓时间</th>
                                <th rowspan="2">出仓人</th>
                                <th rowspan="2">校验</th>
                                <th rowspan="2">出仓单号</th>
                            </tr>
                            <tr>
                                <th>型号</th>
                                <th>长宽高</th>
                                <th>形状</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>1</td>
                                <td>仓库</td>
                                <td>01</td>
                                <td></td>
                                <td>电商库存</td>
                                <td></td>
                                <td>720*640*130</td>
                                <td></td>
                                <td>龙头456782</td>
                                <td>231654689</td>
                                <td>3246549</td>
                                <td>入库完毕</td>
                                <td>10-10 10：10</td>
                                <td>张三</td>
                                <td>10-10 10：10</td>
                                <td>张三</td>
                                <td></td>
                                <td>98796556</td>
                            </tr>

                            </tbody>
                        </table>

                    </div>
                </div>
            </div>


        </div>
        <!-- end row -->
    </div>
    <!-- end well -->


</div>


<%- include('../layouts/footer'); %>
<%- include('../layouts/footer_common_script'); %>


<script type="text/javascript">

    $(document).ready(function () {

        pageSetUp();


        $("#submitOrder").click(function () {
            layer.confirm('确认标记为审核中?', {icon: 3, title: '提示'}, function (index) {
//                $.ajax({
//                    url: '/order/doSubmit/'+tid,
//                    method: 'post',
//                    success: function (data) {
//                        window.location.reload();
//                    }
//                });
            }, function (index) {
                layer.close(index)
            })
        })
        $("#doTearPass").click(function () {
            layer.confirm('确定拆单完毕吗？', {icon: 3, title: '提示'}, function (index) {
                layer.close(index)
            }, function (index) {
                layer.close(index)
            })
        })
        $("#doTearCheckPass").click(function () {
            layer.confirm('确定拆单完毕吗？', {icon: 3, title: '提示'}, function (index) {
                layer.close(index)
            }, function (index) {
                layer.close(index)
            })
        })
        $('#orderItem').on({
            click: function (e) {
                layer.open({
                    title: false,
                    type: 1,
                    area: '1200px',
                    content: $('#orderItemCon'),
                    cancel: function () {
                        //右上角关闭回调
                    },

                });
            }
        })


    })

</script>
<%- include('../layouts/foot'); %>
<%- include('./check_pass'); %>
<%- include('./order_reject'); %>

