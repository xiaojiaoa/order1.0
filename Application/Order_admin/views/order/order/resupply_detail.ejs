<%- include('../layouts/head_top'); %>
<%- include('../layouts/head_bottom'); %>
<%- include('../layouts/header'); %>
<%- include('../layouts/nav'); %>


<!-- MAIN PANEL -->
<div id="main" role="main">

    <!-- RIBBON -->
    <div id="ribbon">

        <!-- breadcrumb -->
        <ol class="breadcrumb">
            <li>后台管理</li>
            <li>补单信息</li>
        </ol>
        <!-- end breadcrumb -->
    </div>
    <!-- END RIBBON -->


    <!-- MAIN CONTENT -->
    <div id="content">


        <!-- well -->
        <div class="well dwy-show-well">
            <!-- row -->
            <div class="row">
                <!-- col -->
                <div class="col-xs-12 dwy-show-content">
                    <legend>基本信息</legend>
                    <!-- row -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped table-information">
                            <tbody>
                            <tr>
                                <td>主材颜色</td>
                                <td>象牙白</td>
                                <td>订单类型</td>
                                <td>新配套-五金</td>
                            </tr>

                            <tr>
                                <td>专卖店</td>
                                <td>浙江省杭州市西湖区湖滨银泰店</td>
                                <td>专卖店编号</td>
                                <td>A12</td>
                            </tr>
                            <tr>
                                <td>收货人</td>
                                <td><%= user.name %></td>
                                <td>联系电话</td>
                                <td>13546798465</td>
                            </tr>
                            <tr>
                                <td>收货地址</td>
                                <td colspan="3">杭州市西湖区西溪路525号</td>
                            </tr>
                            <tr>
                                <td>客户姓名</td>
                                <td><%= user.name %></td>
                                <td>客户电话</td>
                                <td>1354678946532</td>
                            </tr>
                            <tr>
                                <td>建单人</td>
                                <td><%= user.name %></td>
                                <td>建单时间</td>
                                <td>2016-10-10   10：10：10</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td></td>
                                <td>提交时间</td>
                                <td>2016-10-10   10：10：10</td>
                            </tr>
                            <tr>
                                <td>问题反馈</td>
                                <td colspan="3">asjkd-21546衣柜</td>
                            </tr>
                            <tr>
                                <td>增单规格/数量</td>
                                <td colspan="3"></td>
                            </tr>
                            <tr>
                                <td>补单规格/数量</td>
                                <td colspan="3">asjkd-21546衣柜1个</td>
                            </tr>
                            <tr>
                                <td>增补类型</td>
                                <td>补单</td>
                                <td>难度等级</td>
                                <td>四级</td>
                            </tr>
                            <tr>

                                <td>零售价</td>
                                <td>0.00元</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>补单原因</td>
                                <td>加盟商错误，客户新增</td>
                                <td>信用评级</td>
                                <td>4分（该店平均4.10分）</td>
                            </tr>
                            <tr>
                                <td>受理意见</td>
                                <td colspan="3"></td>
                            </tr>
                            <tr>
                                <td>同客户订单</td>
                                <td colspan="3">
                                    <a href="/order//" class="order-number">231465489456</a>
                                    <a href="/order//" class="order-number">231465489456</a>
                                </td>
                            </tr>
                            <tr>
                                <td>同客户补单</td>
                                <td colspan="3">
                                    <a href="/order/resupply/detail/11222" class="order-number">231465489456</a>
                                    <a href="/order/resupply/detail/11222" class="order-number">231465489456</a>
                                </td>
                            </tr>

                            <tr>
                                <td>相关订单</td>
                                <td colspan="3">
                                    <a href="/order//" class="order-number">231465489456</a>
                                    <a href="/order//" class="order-number">231465489456</a>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                    </div>


                    <!-- end row -->
                </div>
                <!-- end col -->
            </div>

            <div class="row">
                <!-- col -->
                <div class="col-xs-12 dwy-show-content">
                    <legend>相关文件
                        <% if( (orderInfo.stcode == 250) || (orderInfo.stcode == 450) || (orderInfo.stcode == 475) ){ %>
                        <a class="label label-primary" href="/file/order/create/<%= orderInfo.lid %>/<%= orderInfo.stcode %>/2/<%= tid %>">文件管理</a>
                        <% } %>
                        <% if( orderInfo.stcode == 450 || orderInfo.stcode == 475){ %>
                         <button class="label label-primary" id="orderItem">订单物料</button>
                        <% } %>
                    </legend>

                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                            <tr>
                                <th>序号</th>
                                <th>文件名</th>
                                <th>文件类型</th>
                                <!--<th>文件大小</th>-->
                                <th>上传人</th>
                                <th>上传时间</th>
                                <th>备注</th>
                            </tr>
                            </thead>
                            <tbody>


                            </tbody>
                        </table>

                    </div>


                    <!-- end row -->
                </div>
                <!-- end col -->
            </div>


            <div class="row">
                <!-- col -->
                <div class="col-xs-12 dwy-show-content">
                    <legend>状态信息  (调试订单状态:<%= orderInfo.stcode %><%= DWY_Helper.getAssistVal(orderInfo.stcode, stcodeInfo) %> )

                        <% if( (orderInfo.stcode == 250) || (orderInfo.stcode == 450) || (orderInfo.stcode == 475) ){ %>
                        <a class="label label-primary" id="doUnlock" data-stcode="<%= orderInfo.stcode %>">&nbsp; 解锁 &nbsp;</a>
                        <% } %>
                    </legend>
                    <!-- row -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped table-information">
                            <tbody>
                            <tr>
                                <td>许可状态</td>
                                <td colspan="3">审核未加急   拆单许可</td>
                            </tr>
                            <tr>
                                <td width="20%">受理时间</td>
                                <% switch (orderInfo.stcode){
                                case 250: %>
                                <td width="30%">
                                    受理中
                                    <a class="label label-primary doPass"  data-stcode="<%= orderInfo.stcode %>">确认受理</a>
                                    <a class="label label-primary margin-left-20 reject-modal">补单受理退回</a>
                                </td>
                                <%        break;
                                case 220: %>
                                <td>
                                    待受理
                                    <a class="label label-primary doGetTask" data-stcode="<%= orderInfo.stcode %>">标记为受理中</a>
                                </td>
                                <%         break;
                                    default: %>
                                <td></td>
                                <%  } %>

                                <td width="20%">受理人</td>
                                <td width="30%"></td>
                            </tr>

                            <tr>
                                <td>补单确认</td>
                                <td></td>
                                <td>确认人</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>收款确认</td>
                                <td></td>
                                <td>确认人</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>拆单时间</td>
                                <% switch (orderInfo.stcode){
                                case 450: %>
                                <td>
                                    拆单中
                                    <a class="label label-primary doPass"  data-stcode="<%= orderInfo.stcode %>">确认拆单</a>
                                    <a class="label label-primary margin-left-20 reject-modal">拆单退回</a>
                                </td>
                                <%        break;
                                case 290: %>
                                <td>
                                    待拆单
                                    <a class="label label-primary doGetTask" data-stcode="<%= orderInfo.stcode %>">标记为拆单中</a>
                                </td>
                                <%         break;
                                    default: %>
                                <td></td>
                                <%  } %>

                                <td>拆单人</td>
                                <td></td>
                            </tr>

                            <tr>
                                <td>特排时间</td>
                                <td></td>
                                <td>特排人</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>排产时间</td>
                                <td></td>
                                <td>排产人</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>入库日期</td>
                                <td></td>
                                <td>货架号</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>出仓时间</td>
                                <td></td>
                                <td>出仓人</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>发货日期</td>
                                <td></td>
                                <td>货运单号</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>开始安装时间</td>
                                <td></td>
                                <td>结束安装时间</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>安装人</td>
                                <td></td>
                                <td>安装次数</td>
                                <td>2次</td>
                            </tr>
                            <tr>
                                <td>安装意见</td>
                                <td colspan="3"></td>
                            </tr>

                            <tr>
                                <td>流程记录</td>
                                <td colspan="3">发浙联物流，自提 <a class="margin-left-20" href="/order/process">添加/查看更多</a></td>
                            </tr>

                            </tbody>
                        </table>

                    </div>


                    <!-- end row -->
                </div>
                <!-- end col -->
            </div>

            <div class="row">

                <div class="col-xs-12">
                    <legend>发货清单</legend>
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>

                            <tr>
                                <th>序号</th>
                                <th>车间</th>
                                <th>包号</th>
                                <th>属性</th>
                                <th>特包</th>
                                <th>产品名称</th>
                                <th>流水号</th>
                                <th>批号</th>
                                <th>入库时间</th>
                                <th>接收人</th>
                                <th>出仓时间</th>
                                <th>出仓人</th>
                                <th>校验</th>
                                <th>出仓单号</th>
                            </tr>

                            </thead>
                            <tbody>
                            <tr>
                                <td>1</td>
                                <td>仓库</td>
                                <td>01</td>
                                <td></td>
                                <td>电商库存</td>
                                <td>龙头456782</td>
                                <td>231654689</td>
                                <td>3246549</td>
                                <td>10-10  10：10</td>
                                <td><%= user.name %></td>
                                <td>10-10  10：10</td>
                                <td><%= user.name %></td>
                                <td></td>
                                <td>98796556</td>
                            </tr>

                            </tbody>
                        </table>

                    </div>
                </div>
            </div>


        </div>
        <!-- end row -->
    </div>
    <!-- end well -->


</div>


<%- include('../layouts/footer'); %>
<%- include('../layouts/footer_common_script'); %>


<script type="text/javascript">

    $(document).ready(function () {
        pageSetUp();

        $(".doGetTask").click(function () {
            var orderStcode = $(this).attr('data-stcode');
            var ajaxUrl = '';
            var locationUrl = '';
            var text = '';
            switch (orderStcode){
                case '220':
                    ajaxUrl = '/orders/getTask/<%= tid %>';
                    locationUrl = '/order/check/getOrder';
                    text = '确认标记为审核中?';
                    break;
                case '290':
                    ajaxUrl = '/apart/getTask/<%= tid %>';
                    locationUrl = '/apart';
                    text = '确认标记为拆单中?';
                    break;
                case '472':
                    ajaxUrl = '/apartCheck/getTask/<%= tid %>';
                    locationUrl = '/apart/check';
                    text = '确认标记为拆单审核中?';
                    break;
            }
            layer.confirm(text, {icon: 3, title: '提示'}, function (index) {
                $.ajax({
                    url: ajaxUrl,
                    method: 'post',
                    success: function (data) {
                        location.href = locationUrl
                    },
                    error: function (response) {
                        layer.close(index)
                        var data = JSON.parse(response.responseText);
//                        var data = (response.responseText);
                        $.smallBox({
                            title: "操作失败",
                            content: data.msg,
                            color: "#C46A69",
                            iconSmall: "fa fa-times fa-2x fadeInRight animated",
                            timeout: 3000
                        });
                    }
                });
            }, function (index) { layer.close(index) })
        })

        $("#doUnlock").click(function () {
            var orderStcode = $(this).attr('data-stcode');
            var ajaxUrl = '';
            var locationUrl = '';
            switch (orderStcode){
                case '250':
                    ajaxUrl = '/orders/unlock/<%= tid %>';
                    locationUrl = '/order/check/waitOrder';
                    break;
                case '450':
                    ajaxUrl = '/apart/unlock/<%= tid %>';
                    locationUrl = '/apart';
                    break;
                case '475':
                    ajaxUrl = '/apartCheck/unlock/<%= tid %>';
                    locationUrl = '/apart/check';
                    break;
            }
            layer.confirm('确认解锁该订单?', {icon: 3, title: '提示'}, function (index) {
                $.ajax({
                    url: ajaxUrl,
                    method: 'post',
                    success: function (data) {
                        location.href = locationUrl
                    }
                });
            }, function (index) { layer.close(index) })
        })

        $(".doPass").click(function () {
            var orderStcode = $(this).attr('data-stcode');
            var ajaxUrl = '';
            var locationUrl = '';
            var text = '';
            switch (orderStcode){
                case '450':
                    ajaxUrl = '/apart/doPass/<%= tid %>';
                    locationUrl = '/apart';
                    text = '确定拆单完毕吗?';
                    break;
                case '475':
                    ajaxUrl = '/apartCheck/doPass/<%= tid %>';
                    locationUrl = '/apart/check';
                    text = '确认拆单审核完毕吗?';
                    break;

            }
            layer.confirm(text, {icon: 3, title: '提示'}, function (index) {
                $.ajax({
                    url: ajaxUrl,
                    method: 'post',
                    success: function (data) {
                        location.href = locationUrl
                    },
                    error: function (response) {
                        layer.close(index)
                        var data = JSON.parse(response.responseText);
//                        var data = (response.responseText);
                        $.smallBox({
                            title: "操作失败",
                            content: data.msg,
                            color: "#C46A69",
                            iconSmall: "fa fa-times fa-2x fadeInRight animated",
                            timeout: 3000
                        });
                    }
                });
            }, function (index) { layer.close(index) })
        })

    })

</script>


<%- include('../layouts/foot'); %>
<%- include('./check_pass'); %>
<%- include('./order_reject'); %>
<%- include('./materiel_modal'); %>

