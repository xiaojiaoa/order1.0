<script type="text/javascript">

    $(document).ready(function () {

        var seaAllStat=false;//标记"查看所有"点击状态
        var openAllStat=false;//标记"启用所有"点击状态
        var index;//点击的tr的位置

        //点击"新建"，"修改"
        $(".create,.modify").on("click",function(e){

            var level = $(this).parent().attr('data-level');
            var classDom=$('.'+level);
            classDom.find('.status01,.status03').hide();
            classDom.find('.status02').show();

            //获取key值
            var key=$("input[name=key]").val();

            //禁用所有的点击事件
            $(".desktop-detected *").css("pointer-events","none");

            //点击"新建"
            if (e.target == $('.'+level+" .create")[0]) {

                classDom.find(".save").attr("change",1);
                classDom.find(".revoke").attr("change",1);

               if(key=='subPackageDao'){
                   status02(classDom);
                   $(".desktop-detected *").css("pointer-events","auto");
                   layer.open({
                       title: false,
                       type: 1,
                       area: '700px',
                       content: $('#create-subPackageDao-form'),
                       cancel: function () {
                           //右上角关闭回调
                       },

                   });
               }
               else{
                   classDom.find("tbody").append(creFrag(key)).find("input").focus();

                   //启用'保存''撤销''输入框'的点击事件
                   classDom.find(".save,.revoke,.add-input").css("pointer-events","auto");
               }

            }

            //点击"修改"
            if (e.target == $('.'+level+" .modify")[0]) {

                classDom.find(".save").attr("change",0);
                classDom.find(".revoke").attr("change",0);

                if(key=='subPackageDao'){
                    status02(classDom);
                    $(".desktop-detected *").css("pointer-events","auto");

                    //给表单赋值
                    console.log(classDom.find("tr").eq(index).find("input[name=code]").val())
                    console.log(classDom.find("tr").eq(index).find("input[name=name]").val());
                    $("#subPackageDaoCode").val(classDom.find("tr").eq(index).attr("code"));
                    $("#subPackageDaoName").val(classDom.find("tr").eq(index).find("input[name=name]").val());
                    $("#subPackageDaoId").val(classDom.find("tr").eq(index).attr("id"));
                    layer.open({
                        title: false,
                        type: 1,
                        area: '700px',
                        content: $('#modify-subPackageDao-form'),
                        cancel: function () {
                            //右上角关闭回调
                        },

                    });
                }
              else{

                  //根据有无点击tr执行取消readonly属性
                    if(key=="assistantConfig"){
                      classDom.find("tr").eq(index).addClass("add-input").find("input[name=code],input[name=value]").removeAttr('readonly').focus();
                  }
                  else{
                      classDom.find("tr").eq(index).addClass("add-input").find("input").removeAttr('readonly').focus();
                  }

                  //启用'保存''撤销''输入框'的点击事件
                  classDom.find(".save,.revoke,.add-input *").css("pointer-events","auto");


              }

            }
        });

        //保存
        $(".save").on("click",function(){

            var level = $(this).parent().attr('data-level');
            var classDom=$('.'+level);
            //获取key值
            var key=$("input[name=key]").val();
            //设置data
            var data={};
            classDom.find("input").each(function(){
                if(!$(this).attr("readonly")){
                    data[$(this).attr("name")]=$(this).val();
                }
            });

            var spaceId=classDom.find("input[name=spaceId]").val();
            console.log("spaceId："+spaceId);
            if(key=="assistantOrderSpaceinfo"){
                if(!data.key){
                    if(spaceId==""){
                        data.key="assistantSpaceProd";
                        data.spaceId=$(".level-3").find("input[name=parentId]").val();
                    }
                    else{
                        data.key="assistantOrderSpaceinfo";
                        data.parentId=$(".level-2").find("input[name=parentId]").val();
                    }
                }
                else{
                    data.parentId=0
                }
            }

            if(key=="assistantResupplyReason"){
                data.key="assistantResupplyReason";
                //console.log(level);
                if(level=="level-1"){
                    data.levelType=1
                    data.parentId=0
                }
                if(level=="level-2"){
                    data.levelType=2
                    data.parentId=$(".level-2").find("input[name=parentId]").val();
                }
                if(level=="level-3"){
                    data.levelType=3
                    data.parentId=$(".level-3").find("input[name=parentId]").val();
                }
            }

            //新建--保存
            if( classDom.find(".save").attr('change')==1){
                delete data.undefined;
                console.log("这个是新建data"+JSON.stringify(data));
                $.ajax({
                    url: '/system/doCreate',
                    data:data,
                    method: 'post',
                    success: function (data) {

                        //刷新页面
                        ajaxRefresh(key,level);

                        //重置按钮
                        status02(classDom);
                        //启用所有的点击事件
                        $(".desktop-detected *").css("pointer-events","auto");
                        classDom.find(".save").removeAttr("change");
                    },
                    error: function (response) {
                        layer.close(index)
                        errorLayout.normal(response);
                    }
                });
            }
            //修改--保存
            if( classDom.find(".save").attr('change')==0){
                var id=classDom.find("tr").eq(index).attr("id");
                data.id=id;
                delete data.undefined;
                console.log("这个是修改data"+JSON.stringify(data));
                $.ajax({
                    url: '/system/doModify/'+id,
                    data:data,
                    method: 'post',
                    success: function (data) {

                        //刷新页面
                        ajaxRefresh(key,level);

                        //重置按钮
                        status02(classDom);
                        if(key=="assistantConfig"){
                            $(".create ").hide();
                            $(".delete").hide();
                        }
                        else{
                            $(".create").show();
                            $(".delete").show();
                        }
                        //启用所有的点击事件
                        $(".desktop-detected *").css("pointer-events","auto");
                        classDom.find(".save").removeAttr("change");
                    },
                    error: function (response) {
                        layer.close(index)
                        errorLayout.normal(response);
                    }
                });
            }

        });

        //撤销
        $(".revoke").on("click",function(){
            var level = $(this).parent().attr('data-level');
            var classDom=$('.'+level);
            //获取key值
            var key=$("input[name=key]").val();

            //新建--撤销
            if( classDom.find(".revoke").attr('change')==1){
                //重置按钮
                status02(classDom);
                //启用所有的点击事件
                $(".desktop-detected *").css("pointer-events","auto");
                classDom.find(".save").removeAttr("change");
            }

            //修改--撤销
            if(classDom.find(".revoke").attr('change')==0){
                //刷新页面
                ajaxRefresh(key,level);

                //重置按钮
                status02(classDom);
                if(key=="assistantConfig"){
                    $(".create ").hide();
                    $(".delete").hide();
                }
                else{
                    $(".create").show();
                    $(".delete").show();
                }
                //启用所有的点击事件
                $(".desktop-detected *").css("pointer-events","auto");
                classDom.find(".save").removeAttr("change");
            }

        });

        //点击"删除"
        $(".delete").click(function () {

            var level = $(this).parent().attr('data-level');
            var classDom=$('.'+level);

            //获取key值
            var key=$("input[name=key]").val();
            //设置data
            var data={};
            classDom.find("input").each(function(){
                if(!$(this).attr("readonly")){
                    data[$(this).attr("name")]=$(this).val();
                }
            });
            var id=classDom.find("tr").eq(index).attr("id");
            var stcode=classDom.find("tr").eq(index).attr("stcode");
            data.id=id;

            if(key=="assistantConfig"){
                data.status=0;
            }
            else{
                data.stcode=0;
            }

            delete data.undefined;

            var spaceId=classDom.find("input[name=spaceId]").val();
            if(key=="assistantOrderSpaceinfo"){
                if(!data.key){
                    if(spaceId==""){
                        data.key="assistantSpaceProd";
                        data.spaceId=$(".level-2").find("tr").eq(index).attr("id");
                    }
                    else{
                        data.key="assistantOrderSpaceinfo";
                        data.parentId=$(".level-1").find("tr").eq(index).attr("id");
                    }
                }
                else{
                    data.parentId=0
                }
            }

            if(key=="assistantResupplyReason"){
                data.key="assistantResupplyReason";
                if(data.levelType==1){
                    data.parentId=0
                }
                if(data.levelType==2){
                    data.parentId=$(".level-1").find("tr").eq(index).attr("id")
                }
                if(data.levelType==3){
                    data.parentId=$(".level-2").find("tr").eq(index).attr("id")
                }
            }
            console.log("这个是删除等操作"+JSON.stringify(data));
            //ajax提交
            layer.confirm('确定删除该项?', {icon: 3, title: '提示'}, function (index) {
         $.ajax({
         url: '/system/doModify/'+id,
         data:data,
         method: 'post',
         success: function (data) {

             //刷新页面
             ajaxRefresh(key,level);

             //重置按钮
             $('.status01').show()

             //关闭弹窗
             layer.close(index);
         },
         error: function (response) {
         layer.close(index)
         errorLayout.normal(response);
         }
         });

         }, function (index) { layer.close(index) })
    })

        //点击"启用"
        $('.open-this').click(function(){

            var level = $(this).parent().attr('data-level');
            var classDom=$('.'+level);
            classDom.find('.modify').show();
            $(this).hide();

            //获取key值
            var key=$("input[name=key]").val();
            //设置data
            var data={};
            classDom.find("input").each(function(){
                if(!$(this).attr("readonly")){
                    data[$(this).attr("name")]=$(this).val();
                }
            });
            var id=classDom.find("tr").eq(index).attr("id");
            var stcode=classDom.find("tr").eq(index).attr("stcode");
            data.id=id;

            if(key=="assistantConfig"){
                data.status=1;
            }
            else{
                data.stcode=1;
            }

            var spaceId=classDom.find("input[name=spaceId]").val();
            if(key=="assistantOrderSpaceinfo"){
                if(!data.key){
                    if(spaceId==""){
                        data.key="assistantSpaceProd";
                        data.spaceId=$(".level-2").find("tr").eq(index).attr("id");
                    }
                    else{
                        data.key="assistantOrderSpaceinfo";
                        data.parentId=$(".level-1").find("tr").eq(index).attr("id");
                    }
                }
                else{
                    data.parentId=0
                }
            }

            if(key=="assistantResupplyReason"){
                data.key="assistantResupplyReason";
                if(data.levelType==1){
                    data.parentId=0
                }
                if(data.levelType==2){
                    data.parentId=$(".level-1").find("tr").eq(index).attr("id")
                }
                if(data.levelType==3){
                    data.parentId=$(".level-2").find("tr").eq(index).attr("id")
                }
            }
            console.log("这个是启用等操作"+JSON.stringify(data));
            //ajax提交
            layer.confirm('确定启用该项?', {icon: 3, title: '提示'}, function (index) {
                $.ajax({
                    url: '/system/doModify/'+id,
                    data:data,
                    method: 'post',
                    success: function (data) {

                        //刷新页面
                        ajaxRefresh(key,level);

                        //重置按钮
                        $('.status01').show()
                        //关闭弹窗
                        layer.close(index);
                    },
                    error: function (response) {
                        layer.close(index)
                        errorLayout.normal(response);
                    }
                });
            }, function (index) { layer.close(index) })
        });

        //点击tr
        $(document).on("click","table>tbody>tr",function(){

            if(!$(this).hasClass('add-input')){
                $(this).addClass("active").siblings("tr").removeClass("active");
                index=$(this).index();
            }

            //点击的是"disable"
            if($(this).hasClass('disable')){
                var classDom = $(this).parent().parent().parent();
                classDom.find('.modify').hide();
                classDom.find('.open-this').show();
            }
        });

        //点击"查看所有"
        $('.see-all').click(function () {

            var level = $(this).parent().attr('data-level');
            var classDom=$('.'+level);


           /* classDom.find('.open-all').show();*/
            seaAllStat=true;

            var key=classDom.find("input[name=key]").val();

            layer.confirm('确定查看所有?', {icon: 3, title: '提示'}, function (index) {
                 classDom.find('.see-all').hide();
                 classDom.find('.disable').removeClass('display-none');
                layer.close(index)
            }, function (index) { layer.close(index) })
        })

        //点击"启用所有"
/*        $('.open-all').click(function () {

            var level = $(this).parent().attr('data-level');
            var classDom=$('.'+level);

            $(this).hide();
          /!*  classDom.find('.disable').removeAttr('class');*!/
            openAllStat=true;

            layer.confirm('确定启用所有?', {icon: 3, title: '提示'}, function (index) {
                $.ajax({
                    url: '/enterMaterial/doPass/',
                    method: 'put',
                    success: function (data) {
                        successLayout.reload();
                    },
                    error: function (response) {
                        layer.close(index)
                        errorLayout.normal(response);
                    }
                });
            }, function (index) { layer.close(index) })
        })*/


        /*
         * status02--用于点击"撤销"、"保存"之后返回的三个状态
         * */
        function status02(dom){

            dom.find('.status01').show();
            dom.find('.status02').hide();

           /* //根据"查看所有"点击状态显示"启用所有"
            if(seaAllStat){
                dom.find('.see-all').hide();
                dom.find('.open-all').show();
            }

            //根据"启用所有"点击状态显示"启用所有"
            if(openAllStat){
                dom.find('.open-all').hide();
            }*/
        }

       /*
       * creFrag--新建的时候根据不同显示页面
       * */
        function creFrag(key){
            var string;
            if(key=="assistantConfig"){
                string="<tr class='add-input'>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='code'/></td>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='value'/></td>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='remark'/></td>" +
                    "</tr>"
        }
            else  if(key=="assistantBrandInfo"){
                string="<tr class='add-input'>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='name'/></td>" +
                    "</tr>"
            }
            else  if(key=="assistantOrderSpaceinfo"){
                string="<tr class='add-input'>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='name'/></td>" +
                    "</tr>"
            }
            else  if(key=="assistantSpaceProd"){
                string="<tr class='add-input'>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='name'/></td>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='spaceId'/></td>" +
                    "</tr>"
            }
            else  if(key=="assistantResupplyReason"){
                string="<tr class='add-input'>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='name'/></td>" +
                    "</tr>"
            }
            else  if(key=="assistantReviewReson"){
                string="<tr class='add-input'>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='name'/></td>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='reasonType'/></td>" +
                    "</tr>"
            }
            else  if(key=="assistantTaskseqFileType"){
                string="<tr class='add-input'>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='type'/></td>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='fileExt'/></td>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='name'/></td>" +
                    "</tr>"
            }
            else{
                string="<tr class='add-input'>" +
                    "<td><input class='border-0 text-align-center' type='text' value='' name='name'/></td>" +
                    "</tr>"
            }
            //console.log(string);
            return string;
        }

        /*
        * ajaxRefresh--用于ajax请求成功之后的刷新页面
        * */
        function ajaxRefresh(key,level){
            if(key=='assistantOrderSpaceinfo'){
                if(level=="level-1"){
                    ajaxFuncOne(key);
                }
                if(level=="level-2"){
                    var parentId=$(".level-2").find("input[name=parentId]").val();
                   // console.log('level-2',parentId);
                    ajaxOrderSpaceinfoOne(parentId);
                }
                if(level=="level-3"){
                    var parentId=$(".level-3").find("input[name=parentId]").val();
                    ajaxOrderSpaceinfoTwo(parentId);
                }
            }
            else if(key=='assistantResupplyReason'){
                if(level=="level-1"){
                    ajaxFuncOne(key);
                }
                if(level=="level-2"){
                    var parentId=$(".level-2").find("input[name=parentId]").val();
                    //console.log('level-2',parentId);
                    ajaxResupplyReason0ne(parentId);
                }
                if(level=="level-3"){
                    var parentId=$(".level-3").find("input[name=parentId]").val();
                    ajaxResupplyReasonTwo(parentId);
                }
            }
            else{
                ajaxFuncOne(key);
            }
        }

    })
</script>